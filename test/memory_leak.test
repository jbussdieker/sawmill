#!/bin/bash
(
	for i in {1..500000}; do
	  echo "\"asdfqwer\""
	done
) | ./bin/sawmill --host localhost --port -1 - &


for (( ; ; )); do
  # Get test proc pid
  PID=`ps -edf | grep sawmill | grep -v grep | awk '{print $2}'`

  # Still running?
  ps -edf | grep sawmill | grep -v grep &> /dev/null
  [[ "$?" != "0" ]] && break

  # Print RSS and sleep
  RSS=`ps -y -l -p $PID | tail -n 1 | awk '{print $8}'`
  echo "Memory Usage: $RSS bytes"
  sleep 1
done

exit 0
